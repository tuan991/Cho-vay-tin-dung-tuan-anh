<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dịch Vụ Vay Tài Chính Tuấn Anh Mirae</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0066cc;
      --primary-dark:#003366;
      --bg:#f5f7fa;
      --card:#ffffff;
      --muted:#6b7280;
      --ok:#2e7d32;
      --danger:#b91c1c;
      --soft:#e9f1fb;
      --border:#eef2f7;
    }
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg);
      color: #333;
    }

    header {
      background-color: var(--primary);
      color: white;
      padding: 18px 16px;
      text-align: center;
    }
    header h1 { margin: 6px 0; font-size: 26px; line-height: 1.2; }
    header .sub { font-size: 14px; opacity: 0.95; }

    nav {
      margin-top: 10px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }
    nav button {
      appearance:none;
      border: none;
      background: rgba(255,255,255,0.12);
      color: white;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      transition: transform .06s ease;
    }
    nav button:hover { transform: translateY(-1px); }
    nav button:active { transform: translateY(0px); }

    .hero {
      background-color: var(--ok);
      padding: 70px 16px;
      text-align: center;
      color: white;
    }
    .hero h2 { font-size: 34px; margin: 0 0 10px; }
    .hero p { font-size: 18px; margin: 0; opacity: 0.95; }

    .container{
      max-width: 1050px;
      margin: 0 auto;
      padding: 22px 16px 40px;
    }

    .panel {
      display:none;
      margin: 18px auto 0;
      max-width: 950px;
      background: var(--card);
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }
    .panel.active { display:block; }

    .panel-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      padding-bottom: 12px;
      margin-bottom: 14px;
    }
    .panel-header h2{ margin: 0; font-size: 20px; }
    .panel-header .hint{ color: var(--muted); font-size: 13px; }

    .features {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 18px;
      padding: 12px 0 18px;
    }
    .feature {
      width: 300px;
      background-color: var(--soft);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.03);
    }
    .feature h3 { color: var(--primary); margin: 6px 0 10px; }

    .pill{
      display:inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: #eef2ff;
      border: 1px solid #e5e7eb;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 820px){
      .grid{ grid-template-columns: 1fr; }
      .feature{ width: 100%; }
    }

    label{
      display:block;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    input, textarea, select{
      width:100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 10px;
      font-size: 14px;
      outline: none;
      box-sizing: border-box;
      background: #fff;
    }
    textarea{ min-height: 90px; resize: vertical; }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
      align-items:center;
    }
    .btn{
      border:none;
      padding: 10px 14px;
      border-radius: 10px;
      cursor:pointer;
      font-weight: 800;
      background: var(--primary);
      color:#fff;
    }
    .btn.ghost{ background: #e5e7eb; color:#111827; }
    .btn.danger{ background: var(--danger); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    .table{
      width:100%;
      border-collapse: collapse;
      margin-top: 14px;
      overflow:hidden;
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    .table th, .table td{
      text-align:left;
      padding: 10px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      vertical-align: top;
    }
    .table th{
      background: #f8fafc;
      font-size: 13px;
      color: #111827;
    }

    .split{
      display:grid;
      grid-template-columns: 1.3fr 0.9fr;
      gap: 16px;
    }
    @media (max-width: 900px){
      .split{ grid-template-columns: 1fr; }
    }

    .card{
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      background: #fff;
    }
    .card h3{ margin: 0 0 10px; font-size: 16px; }
    .muted{ color: var(--muted); font-size: 13px; }

    .contact-links{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .contact-links a{
      display:inline-block;
      padding: 10px 14px;
      border-radius: 10px;
      text-decoration:none;
      font-weight: 800;
      color:#111827;
      background:#e5e7eb;
    }

    .status{
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f8fafc;
      color: #111827;
      display:none;
    }
    .status.show{ display:block; }

    footer {
      background-color: var(--primary-dark);
      color: white;
      text-align: center;
      padding: 18px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Dịch Vụ Vay Tài Chính Tuấn Anh Mirae</h1>
    <div class="sub">LH/ZALO: <strong>0346635146</strong> • Email: <strong>8444446@gmail.com</strong></div>

    <nav>
      <button type="button" id="btnHome">Trang chủ</button>
      <button type="button" id="btnServices">Dịch vụ</button>
      <button type="button" id="btnRegister">Đăng ký</button>
    </nav>
  </header>

  <section class="hero" id="home">
    <h2>Vay Nhanh - Duyệt Nhanh - Giải Ngân 24–48h</h2>
    <p>Không cần thế chấp • Lãi suất cạnh tranh • Hỗ trợ 24/7</p>
  </section>

  <div class="container">

    <!-- PANEL: Dịch vụ + Thông tin liên hệ -->
    <section class="panel" id="panelServices" aria-live="polite">
      <div class="panel-header">
        <div>
          <h2>Dịch vụ & Thông tin liên hệ</h2>
          <div class="hint">Bạn có thể thêm/sửa/xóa dịch vụ. (Dữ liệu lưu localStorage)</div>
        </div>
      </div>

      <div class="split">
        <!-- LEFT -->
        <div class="card">
          <h3>Dịch vụ đang hiển thị</h3>
          <div class="muted">Khách sẽ thấy các thẻ dịch vụ dưới đây.</div>

          <div class="features" id="servicesCards"></div>

          <hr style="border:none;border-top:1px solid var(--border);margin:14px 0;">

          <h3>Quản lý dịch vụ</h3>
          <div class="grid">
            <div>
              <label for="svcName">Tên dịch vụ</label>
              <input id="svcName" placeholder="Ví dụ: Vay theo lương" />
            </div>
            <div>
              <label for="svcRate">Lãi suất / Thời gian / Ghi chú</label>
              <input id="svcRate" placeholder="Ví dụ: 1.5%–5.5%/tháng hoặc 24–48h" />
            </div>
            <div style="grid-column:1/-1">
              <label for="svcDesc">Mô tả</label>
              <textarea id="svcDesc" placeholder="Mô tả ngắn về điều kiện, giải ngân, khu vực hỗ trợ..."></textarea>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="btnSaveService">Lưu dịch vụ</button>
            <button class="btn ghost" id="btnClearService">Nhập mới</button>
            <button class="btn danger" id="btnDeleteService" disabled>Xóa dịch vụ đang chọn</button>
          </div>

          <table class="table" aria-label="Danh sách dịch vụ">
            <thead>
              <tr>
                <th style="width:28%">Tên</th>
                <th style="width:20%">Thông tin</th>
                <th>Mô tả</th>
                <th style="width:10%">Chọn</th>
              </tr>
            </thead>
            <tbody id="servicesTableBody"></tbody>
          </table>
        </div>

        <!-- RIGHT -->
        <div class="card">
          <h3>Liên hệ nhanh</h3>
          <div class="muted">Khách có thể bấm gọi/nhắn ngay.</div>

          <p style="margin:10px 0 0"><strong>SĐT:</strong> <a href="tel:0346635146">0346635146</a></p>
          <p style="margin:6px 0 0"><strong>Email:</strong> <a href="mailto:8444446@gmail.com">8444446@gmail.com</a></p>
          <p style="margin:6px 0 0"><strong>Facebook:</strong>
            <a target="_blank" rel="noopener" href="https://www.facebook.com/profile.php?id=61582350717268">Mở Facebook</a>
          </p>

          <div class="contact-links">
            <a href="https://zalo.me/0346635146" target="_blank" rel="noopener">Nhắn Zalo</a>
            <a href="mailto:8444446@gmail.com">Gửi Email</a>
            <a href="https://www.facebook.com/profile.php?id=61582350717268" target="_blank" rel="noopener">Nhắn Facebook</a>
          </div>

          <hr style="border:none;border-top:1px solid var(--border);margin:14px 0;">
          <div class="muted">
            Khi khách gửi form đăng ký, hệ thống sẽ <strong>gửi email báo về bạn</strong>.
          </div>
        </div>
      </div>
    </section>

    <!-- PANEL: Đăng ký -->
    <section class="panel" id="panelRegister">
      <div class="panel-header">
        <div>
          <h2>Đăng ký vay</h2>
          <div class="hint">Khách điền form — bạn sẽ nhận email thông báo.</div>
        </div>
      </div>

      <form id="registerForm">
        <div class="grid">
          <div>
            <label for="fullName">Họ và tên</label>
            <input id="fullName" required placeholder="Nguyễn Văn A" />
          </div>
          <div>
            <label for="phone">Số điện thoại</label>
            <input id="phone" required inputmode="tel" placeholder="09xxxxxxxx" />
          </div>
          <div>
            <label for="location">Khu vực</label>
            <input id="location" placeholder="TP/Huyện/Quận" />
          </div>
          <div>
            <label for="serviceSelect">Chọn dịch vụ</label>
            <select id="serviceSelect"></select>
          </div>
          <div>
            <label for="amount">Số tiền cần vay (ước tính)</label>
            <input id="amount" inputmode="numeric" placeholder="Ví dụ: 50.000.000" />
          </div>
          <div>
            <label for="income">Thu nhập/tháng (ước tính)</label>
            <input id="income" inputmode="numeric" placeholder="Ví dụ: 12.000.000" />
          </div>
          <div style="grid-column:1/-1">
            <label for="note">Ghi chú</label>
            <textarea id="note" placeholder="Bạn muốn tư vấn thêm điều gì?"></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="btn" type="submit" id="btnSubmitReg">Gửi đăng ký</button>
          <button class="btn ghost" type="reset">Nhập lại</button>
        </div>
      </form>

      <div class="status" id="registerStatus"></div>
    </section>

  </div>

  <footer>
    © 2025 Dịch vụ vay tiêu dùng, tài chính, kinh doanh • © TUẤN ANH MIRAE • © MIRAE ASSET
  </footer>

  <!-- iframe ẩn để submit form không chuyển trang -->
  <iframe name="hidden_iframe" style="display:none;"></iframe>

  <script>
    // ✅ URL Apps Script mới của bạn (đã thêm full)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzdV2xXhoc60rBhzTIRG_g_ixnFNnppMTCcNeeRsejvWJz9zQyoF0ljCmIobtnuyJ3p/exec";

    const STORAGE_KEY_SERVICES = "tuankem_services_v2";
    const STORAGE_KEY_REG = "tuankem_registrations_v2";

    let services = [];
    let selectedServiceId = null;

    function uid() {
      return Math.random().toString(16).slice(2) + Date.now().toString(16);
    }

    function escapeHtml(str) {
      return String(str || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function saveServices() {
      localStorage.setItem(STORAGE_KEY_SERVICES, JSON.stringify(services));
    }

    function loadServices() {
      const raw = localStorage.getItem(STORAGE_KEY_SERVICES);
      if (raw) {
        try { services = JSON.parse(raw) || []; }
        catch { services = []; }
      }
      if (!services.length) {
        services = [
          { id: uid(), name: "Giải ngân trong ngày", rate: "24–48h", desc: "Thủ tục đơn giản, nhận tiền chỉ trong 24h-48h." },
          { id: uid(), name: "Lãi suất ưu đãi", rate: "1.5%–5.5%/tháng", desc: "Lãi suất minh bạch & rõ ràng." },
          { id: uid(), name: "Hỗ trợ toàn quốc", rate: "Toàn quốc", desc: "Dù bạn ở đâu, chúng tôi luôn sẵn sàng hỗ trợ." }
        ];
        saveServices();
      }
    }

    function renderServicesCards() {
      const container = document.getElementById("servicesCards");
      container.innerHTML = "";
      services.forEach(s => {
        const div = document.createElement("div");
        div.className = "feature";
        div.innerHTML = `
          <h3>${escapeHtml(s.name)}</h3>
          <div class="pill">${escapeHtml(s.rate || "")}</div>
          <p style="margin-top:10px">${escapeHtml(s.desc || "")}</p>
        `;
        container.appendChild(div);
      });
    }

    function renderServicesTable() {
      const body = document.getElementById("servicesTableBody");
      body.innerHTML = "";
      services.forEach(s => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><strong>${escapeHtml(s.name)}</strong></td>
          <td>${escapeHtml(s.rate || "")}</td>
          <td>${escapeHtml(s.desc || "")}</td>
          <td><button class="btn ghost" type="button" data-id="${s.id}">Chọn</button></td>
        `;
        body.appendChild(tr);
      });

      body.querySelectorAll("button[data-id]").forEach(btn => {
        btn.addEventListener("click", () => selectService(btn.getAttribute("data-id")));
      });
    }

    function renderServiceSelect() {
      const select = document.getElementById("serviceSelect");
      select.innerHTML = "";
      services.forEach(s => {
        const opt = document.createElement("option");
        opt.value = s.id;
        opt.textContent = s.name;
        select.appendChild(opt);
      });
    }

    function clearServiceForm() {
      selectedServiceId = null;
      document.getElementById("svcName").value = "";
      document.getElementById("svcRate").value = "";
      document.getElementById("svcDesc").value = "";
      document.getElementById("btnDeleteService").disabled = true;
    }

    function selectService(id) {
      const s = services.find(x => x.id === id);
      if (!s) return;
      selectedServiceId = id;
      document.getElementById("svcName").value = s.name || "";
      document.getElementById("svcRate").value = s.rate || "";
      document.getElementById("svcDesc").value = s.desc || "";
      document.getElementById("btnDeleteService").disabled = false;
      showPanel("panelServices");
    }

    function showPanel(panelId) {
      ["panelServices","panelRegister"].forEach(id => {
        document.getElementById(id).classList.remove("active");
      });
      document.getElementById(panelId).classList.add("active");
      document.getElementById(panelId).scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function saveRegistrationLocal(payload) {
      const raw = localStorage.getItem(STORAGE_KEY_REG);
      let list = [];
      if (raw) { try { list = JSON.parse(raw) || []; } catch { list = []; } }
      list.unshift(payload);
      localStorage.setItem(STORAGE_KEY_REG, JSON.stringify(list));
    }

    function setStatus(msg, type="info") {
      const box = document.getElementById("registerStatus");
      box.classList.add("show");
      box.style.background = (type === "ok") ? "#ecfdf5" : (type === "warn" ? "#fffbeb" : "#f8fafc");
      box.style.borderColor = (type === "ok") ? "#a7f3d0" : (type === "warn" ? "#fde68a" : "#e5e7eb");
      box.innerHTML = msg;
    }

    // NAV
    document.getElementById("btnHome").addEventListener("click", () => location.reload());
    document.getElementById("btnServices").addEventListener("click", () => showPanel("panelServices"));
    document.getElementById("btnRegister").addEventListener("click", () => showPanel("panelRegister"));

    // SERVICES CRUD
    document.getElementById("btnSaveService").addEventListener("click", () => {
      const name = document.getElementById("svcName").value.trim();
      const rate = document.getElementById("svcRate").value.trim();
      const desc = document.getElementById("svcDesc").value.trim();

      if (!name) { alert("Bạn cần nhập Tên dịch vụ."); return; }

      if (selectedServiceId) {
        const idx = services.findIndex(x => x.id === selectedServiceId);
        if (idx >= 0) services[idx] = { ...services[idx], name, rate, desc };
      } else {
        services.unshift({ id: uid(), name, rate, desc });
      }

      saveServices();
      renderServicesCards();
      renderServicesTable();
      renderServiceSelect();
      clearServiceForm();
      alert("Đã lưu dịch vụ.");
    });

    document.getElementById("btnClearService").addEventListener("click", clearServiceForm);

    document.getElementById("btnDeleteService").addEventListener("click", () => {
      if (!selectedServiceId) return;
      const s = services.find(x => x.id === selectedServiceId);
      if (!s) return;
      if (!confirm(`Xóa dịch vụ "${s.name}"?`)) return;

      services = services.filter(x => x.id !== selectedServiceId);
      saveServices();
      renderServicesCards();
      renderServicesTable();
      renderServiceSelect();
      clearServiceForm();
    });

    // REGISTER SUBMIT: gửi bằng hidden form để không lỗi CORS
    document.getElementById("registerForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const btn = document.getElementById("btnSubmitReg");
      btn.disabled = true;

      const serviceId = document.getElementById("serviceSelect").value;
      const svc = services.find(s => s.id === serviceId);

      const payload = {
        time: new Date().toISOString(),
        fullName: document.getElementById("fullName").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        location: document.getElementById("location").value.trim(),
        serviceName: svc ? svc.name : "",
        amount: document.getElementById("amount").value.trim(),
        income: document.getElementById("income").value.trim(),
        note: document.getElementById("note").value.trim(),
        ownerEmail: "8444446@gmail.com",
        ownerPhone: "0346635146",
        ownerFacebook: "https://www.facebook.com/profile.php?id=61582350717268"
      };

      if (!payload.fullName || !payload.phone) {
        setStatus("Vui lòng nhập <strong>Họ và tên</strong> và <strong>Số điện thoại</strong>.", "warn");
        btn.disabled = false;
        return;
      }

      // Lưu local
      saveRegistrationLocal({ id: uid(), ...payload });

      // Hiện thông báo cho khách
      setStatus(`
        <div class="pill">Đã gửi đăng ký ✅</div>
        <p style="margin:10px 0 0">
          Cảm ơn <strong>${escapeHtml(payload.fullName)}</strong>.
          Chúng tôi sẽ liên hệ số <strong>${escapeHtml(payload.phone)}</strong> sớm.
        </p>
        <p style="margin:6px 0 0;color:var(--muted)">
          Dịch vụ: <strong>${escapeHtml(payload.serviceName)}</strong> • Bạn sẽ nhận email thông báo.
        </p>
      `, "ok");

      // Tạo form hidden để POST
      const form = document.createElement("form");
      form.action = SCRIPT_URL;
      form.method = "POST";
      form.target = "hidden_iframe";

      Object.keys(payload).forEach((k) => {
        const inp = document.createElement("input");
        inp.type = "hidden";
        inp.name = k;
        inp.value = payload[k] || "";
        form.appendChild(inp);
      });

      document.body.appendChild(form);
      form.submit();
      form.remove();

      e.target.reset();
      btn.disabled = false;
    });

    // INIT
    loadServices();
    renderServicesCards();
    renderServicesTable();
    renderServiceSelect();
    showPanel("panelServices");
  </script>
</body>
</html>
